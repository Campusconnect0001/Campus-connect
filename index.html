<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width,initial-scale=1" />
  <title>Campus Connect ‚Äì Unite Your Campus</title>
  <style>
    * { box-sizing: border-box; margin: 0; padding: 0; font-family: "Segoe UI", Roboto, Arial, sans-serif; }
    body { min-height: 100vh; background: #f2f4f8; padding: 20px; }

    /* ===== Header (Unified for all pages) ===== */
    header {
      background: #18ab91;
      color: #fff;
      text-align: center;
      padding: 20px;
      border-radius: 12px;
      box-shadow: 0 4px 10px rgba(0,0,0,0.1);
      margin-bottom: 20px;
      position: relative;
    }
    header img {
      height: 70px;
      width: auto;
      display: block;
      margin: 0 auto 8px auto;
    }
    header h1 {
      font-size: 26px;
      letter-spacing: 1px;
      margin-bottom: 4px;
    }
    header p {
      font-size: 15px;
      opacity: 0.95;
    }

    .view { display: none; }
    .container { position: relative; width: min(900px, 95%); height: 550px; background: #fff; border-radius: 14px; overflow: hidden; box-shadow: 0 10px 30px rgba(0,0,0,0.08); margin: auto; }

    .form-container { position: absolute; top: 0; height: 100%; transition: all 0.6s ease-in-out; }
    .sign-in-container { left: 0; width: 50%; z-index: 2; }
    .sign-up-container { left: 0; width: 50%; opacity: 0; z-index: 1; }
    form { background: #fff; height: 100%; display: flex; flex-direction: column; justify-content: center; align-items: center; padding: 0 50px; text-align: center; }
    form h1 { color: #18ab91; margin-bottom: 14px; font-weight: 700; letter-spacing: .2px; }
    input, select { width: 100%; max-width: 320px; padding: 12px 14px; margin: 8px 0; border-radius: 8px; border: none; background: #f0f1f3; }
    button { margin-top: 14px; padding: 12px 42px; border-radius: 999px; border: none; background: #18ab91; color: #fff; font-weight: 700; letter-spacing: 0.6px; cursor: pointer; transition: transform .08s ease; }
    button:active { transform: scale(.98); }
    button.ghost { background: transparent; border: 2px solid rgba(255,255,255,0.35); color: #fff; padding: 10px 30px; }

    .overlay-container { position: absolute; top: 0; left: 50%; width: 50%; height: 100%; overflow: hidden; transition: transform 0.6s ease-in-out; z-index: 100; }
    .overlay { position: relative; left: -100%; width: 200%; height: 100%; display: flex; align-items: center; transition: transform 0.6s ease-in-out; background: linear-gradient(90deg, #20b39a 0%, #17a88a 100%); color: #fff; }
    .overlay-panel { width: 50%; display: flex; flex-direction: column; align-items: center; justify-content: center; padding: 0 40px; text-align: center; }
    .overlay-panel h1 { font-size: 28px; margin-bottom: 8px; }
    .overlay-panel p { opacity: .95; max-width: 320px; line-height: 1.4; }
    .container.right-panel-active .sign-in-container { transform: translateX(100%); opacity: 0; z-index: 1; }
    .container.right-panel-active .sign-up-container { transform: translateX(100%); opacity: 1; z-index: 5; }
    .container.right-panel-active .overlay-container { transform: translateX(-100%); }
    .container.right-panel-active .overlay { transform: translateX(50%); }

    main { padding: 20px; }

    /* Chat Buttons */
    .chat-buttons {
      display: flex;
      flex-direction: column;
      gap: 15px;
      max-width: 250px;
      margin-top: 10px;
    }
    .chat-btn {
      display: block;
      padding: 12px;
      text-align: center;
      border: 2px solid #18ab91;
      border-radius: 10px;
      color: #18ab91;
      text-decoration: none;
      font-weight: 600;
      background: #fff;
      transition: 0.3s;
    }
    .chat-btn:hover {
      background: #18ab91;
      color: #fff;
    }

    /* Logout button */
    .logout-btn {
      margin-top: 30px;
      padding: 12px 25px;
      border-radius: 10px;
      border: none;
      background: #18ab91;
      color: #fff;
      font-weight: 600;
      cursor: pointer;
      transition: 0.3s;
    }
    .logout-btn:hover { background: #13967d; }

    table { width: 100%; border-collapse: collapse; margin-top: 10px; }
    th, td { padding: 8px; border-bottom: 1px solid #ccc; text-align: left; }
    table button {
      padding: 8px 15px;
      border-radius: 8px;
      border: 2px solid #18ab91;
      background: #fff;
      color: #18ab91;
      cursor: pointer;
      font-weight: 600;
      transition: 0.3s;
    }
    table button:hover { background: #18ab91; color: #fff; }
  </style>
</head>
<body>

  <!-- LOGIN / SIGNUP VIEW -->
  <div id="loginView" class="view" style="display:block;">
    <header>
      <img src="CAMPUS CONNECT.png" alt="Campus Connect Logo">
      <h1>Campus Connect</h1>
      <p>Unite Your Campus</p>
    </header>

    <div class="container" id="container">
      <!-- Sign Up -->
      <div class="form-container sign-up-container">
        <form id="signupForm">
          <h1>Create Account</h1>
          <span style="opacity:.8;margin-bottom:10px;">Use your email for registration</span>
          <input id="signupName" type="text" placeholder="Name" required />
          <input id="signupEmail" type="email" placeholder="Email" required />
          <input id="signupPassword" type="password" placeholder="Password" required />
          <select id="signupRole" required>
            <option value="" disabled selected>Select your role</option>
            <option value="student">Student</option>
            <option value="faculty">Faculty</option>
          </select>
          <button type="submit">Sign Up</button>
        </form>
      </div>

      <!-- Sign In -->
      <div class="form-container sign-in-container">
        <form id="loginForm">
          <h1>Sign In</h1>
          <input id="loginEmail" type="email" placeholder="Email" required />
          <input id="loginPassword" type="password" placeholder="Password" required />
          <button type="submit">Login</button>
        </form>
      </div>

      <!-- Overlay -->
      <div class="overlay-container">
        <div class="overlay">
          <div class="overlay-panel overlay-left">
            <h1>Welcome Back!</h1>
            <p>To keep connected with us please login with your personal info</p>
            <button class="ghost" id="signIn">Sign In</button>
          </div>
          <div class="overlay-panel overlay-right">
            <h1>Hello, Friend!</h1>
            <p>Enter your details and start your journey with us</p>
            <button class="ghost" id="signUp">Sign Up</button>
          </div>
        </div>
      </div>
    </div>
  </div>

  <!-- FACULTY DASHBOARD -->
  <div id="facultyView" class="view">
    <header>
      <img src="CAMPUS CONNECT.png" alt="Campus Connect Logo">
      <h1>Campus Connect</h1>
      <p>Faculty / Admin Dashboard</p>
    </header>
    <main>
      <p>Welcome, you are logged in as Faculty/Admin.</p>
      <h3>Pending Signups:</h3>
      <table id="pendingTable">
        <thead><tr><th>Email</th><th>Role</th><th>Status</th><th>Action</th></tr></thead>
        <tbody></tbody>
      </table>

      <section id="facultyChat" style="margin-top:20px;">
        <h3 style="margin-bottom:15px;">Chat Options</h3>
        <div class="chat-buttons">
          <a href="chat.html" target="_blank" class="chat-btn">üåê Global Chat</a>
          <a href="private.html" target="_blank" class="chat-btn">üí¨ Private Chat</a>
          <a href="groups.html" target="_blank" class="chat-btn">üë• Groups</a>
        </div>
      </section>

      <button id="logoutBtnFaculty" class="logout-btn">Logout</button>
    </main>
  </div>

  <!-- STUDENT DASHBOARD -->
  <div id="studentView" class="view">
    <header>
      <img src="CAMPUS CONNECT.png" alt="Campus Connect Logo">
      <h1>Campus Connect</h1>
      <p>Student Dashboard</p>
    </header>
    <main>
      <p>Welcome, you are logged in as Student.</p>
      <section id="chatLinks">
        <h3 style="margin-bottom:15px;">Chat Options</h3>
        <div class="chat-buttons">
          <a href="chat.html" target="_blank" class="chat-btn">üåê Global Chat</a>
          <a href="private.html" target="_blank" class="chat-btn">üí¨ Private Chat</a>
          <a href="groups.html" target="_blank" class="chat-btn">üë• Groups</a>
        </div>
      </section>
      <button id="logoutBtnStudent" class="logout-btn">Logout</button>
    </main>
  </div>

  <!-- Firebase logic -->
  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/10.8.1/firebase-app.js";
    import { getAuth, createUserWithEmailAndPassword, signInWithEmailAndPassword, signOut, onAuthStateChanged } 
      from "https://www.gstatic.com/firebasejs/10.8.1/firebase-auth.js";
    import { getFirestore, doc, setDoc, getDoc, updateDoc, collection, query, where, onSnapshot, serverTimestamp } 
      from "https://www.gstatic.com/firebasejs/10.8.1/firebase-firestore.js";

    const firebaseConfig = {
      apiKey: "AIzaSyAFKmM22FUSQPYy-eMsBzcZN3bmAxglXl0",
      authDomain: "smart-timetable-266fe.firebaseapp.com",
      projectId: "smart-timetable-266fe"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    function showView(id) {
      document.querySelectorAll('.view').forEach(v => v.style.display='none');
      document.getElementById(id).style.display='block';
    }

    document.getElementById('signupForm').addEventListener('submit', async e=>{
      e.preventDefault();
      const name=document.getElementById('signupName').value;
      const email=document.getElementById('signupEmail').value;
      const pass=document.getElementById('signupPassword').value;
      const role=document.getElementById('signupRole').value;
      try {
        const cred=await createUserWithEmailAndPassword(auth,email,pass);
        await setDoc(doc(db,'users',cred.user.uid),{name,email,role,approved:false,uid:cred.user.uid,createdAt:serverTimestamp()});
        alert('Account created! Awaiting approval.');
        await signOut(auth);
      }catch(e){alert(e.message);}
    });

    document.getElementById('loginForm').addEventListener('submit',async e=>{
      e.preventDefault();
      try{await signInWithEmailAndPassword(auth,loginEmail.value,loginPassword.value);}catch(err){alert(err.message);}
    });

    document.getElementById('logoutBtnFaculty').onclick=()=>signOut(auth);
    document.getElementById('logoutBtnStudent').onclick=()=>signOut(auth);

    onAuthStateChanged(auth,async user=>{
      if(!user)return showView('loginView');
      const d=await getDoc(doc(db,'users',user.uid));
      if(!d.exists())return showView('loginView');
      const p=d.data();
      if(!p.approved){alert('Waiting for approval');await signOut(auth);return;}
      localStorage.setItem('chatUser',JSON.stringify({uid:user.uid,name:p.name,email:p.email}));
      if(p.role==='faculty')showView('facultyView');else showView('studentView');
    });
  
// === Load Pending Signups for Faculty/Admin (real-time) ===
function loadPendingSignups() {
  const tableBody = document.querySelector("#pendingTable tbody");
  if (!tableBody) return;
  if (window._pendingUnsub) { window._pendingUnsub(); window._pendingUnsub = null; }
  const qPending = query(collection(db, "users"), where("approved", "==", false));
  window._pendingUnsub = onSnapshot(qPending, snapshot => {
    tableBody.innerHTML = "";
    snapshot.forEach(docSnap => {
      const user = docSnap.data();
      const tr = document.createElement("tr");
      tr.innerHTML = `
        <td>${user.email || ""}</td>
        <td>${user.role || ""}</td>
        <td>${user.approved ? "Approved" : "Pending"}</td>
        <td><button class="approveBtn" data-id="${user.uid}">Approve</button></td>
      `;
      tableBody.appendChild(tr);
    });

    tableBody.querySelectorAll(".approveBtn").forEach(btn => {
      btn.addEventListener("click", async e => {
        const uid = e.target.getAttribute("data-id");
        if (!uid) return;
        try {
          await updateDoc(doc(db, "users", uid), { approved: true });
          alert("User approved.");
        } catch (err) {
          console.error(err);
          alert("Error approving user: " + err.message);
        }
      });
    });
  }, err => {
    console.error("Error listening to pending users:", err);
  });
}

// === Sign In / Sign Up Animation Fix ===
const _container = document.getElementById('container');
const _signUpButton = document.getElementById('signUp');
const _signInButton = document.getElementById('signIn');
if (_signUpButton && _signInButton && _container) {
  _signUpButton.addEventListener('click', () => _container.classList.add('right-panel-active'));
  _signInButton.addEventListener('click', () => _container.classList.remove('right-panel-active'));
}

// Ensure pending signups are loaded when faculty view is shown after auth
onAuthStateChanged(auth, async user => {
  if (!user) return;
  try {
    const d = await getDoc(doc(db,'users', user.uid));
    if (!d.exists()) return;
    const p = d.data();
    if (p.role === 'faculty') {
      loadPendingSignups();
    }
  } catch (err) {
    console.error(err);
  }
});

</script>
</body>
</html>
